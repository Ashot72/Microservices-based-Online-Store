<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">

<style id="dynCom" type="text/css"><!-- --></style>
<script language="JavaScript"><!--
function msoCommentShow(anchor_id, com_id)
{
	if(msoBrowserCheck()) 
		{
		c = document.all(com_id);
		a = document.all(anchor_id);
		if (null != c && null == c.length && null != a && null == a.length)
			{
			var cw = c.offsetWidth;
			var ch = c.offsetHeight;
			var aw = a.offsetWidth;
			var ah = a.offsetHeight;
			var x  = a.offsetLeft;
			var y  = a.offsetTop;
			var el = a;
			while (el.tagName != "BODY") 
				{
				el = el.offsetParent;
				x = x + el.offsetLeft;
				y = y + el.offsetTop;
				}
			var bw = document.body.clientWidth;
			var bh = document.body.clientHeight;
			var bsl = document.body.scrollLeft;
			var bst = document.body.scrollTop;
			if (x + cw + ah / 2 > bw + bsl && x + aw - ah / 2 - cw >= bsl ) 
				{ c.style.left = x + aw - ah / 2 - cw; }
			else 
				{ c.style.left = x + ah / 2; }
			if (y + ch + ah / 2 > bh + bst && y + ah / 2 - ch >= bst ) 
				{ c.style.top = y + ah / 2 - ch; }
			else 
				{ c.style.top = y + ah / 2; }
			c.style.visibility = "visible";
}	}	}
function msoCommentHide(com_id) 
{
	if(msoBrowserCheck())
		{
		c = document.all(com_id);
		if (null != c && null == c.length)
		{
		c.style.visibility = "hidden";
		c.style.left = -1000;
		c.style.top = -1000;
		} } 
}
function msoBrowserCheck()
{
	ms = navigator.appVersion.indexOf("MSIE");
	vers = navigator.appVersion.substring(ms + 5, ms + 6);
	ie4 = (ms > 0) && (parseInt(vers) >= 4);
	return ie4;
}
if (msoBrowserCheck())
{
	document.styleSheets.dynCom.addRule(".msocomanchor","background: infobackground");
	document.styleSheets.dynCom.addRule(".msocomoff","display: none");
	document.styleSheets.dynCom.addRule(".msocomtxt","visibility: hidden");
	document.styleSheets.dynCom.addRule(".msocomtxt","position: absolute");
	document.styleSheets.dynCom.addRule(".msocomtxt","top: -1000");
	document.styleSheets.dynCom.addRule(".msocomtxt","left: -1000");
	document.styleSheets.dynCom.addRule(".msocomtxt","width: 33%");
	document.styleSheets.dynCom.addRule(".msocomtxt","background: infobackground");
	document.styleSheets.dynCom.addRule(".msocomtxt","color: infotext");
	document.styleSheets.dynCom.addRule(".msocomtxt","border-top: 1pt solid threedlightshadow");
	document.styleSheets.dynCom.addRule(".msocomtxt","border-right: 2pt solid threedshadow");
	document.styleSheets.dynCom.addRule(".msocomtxt","border-bottom: 2pt solid threedshadow");
	document.styleSheets.dynCom.addRule(".msocomtxt","border-left: 1pt solid threedlightshadow");
	document.styleSheets.dynCom.addRule(".msocomtxt","padding: 3pt 3pt 3pt 3pt");
	document.styleSheets.dynCom.addRule(".msocomtxt","z-index: 100");
}
// --></script>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-link:"Comment Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-link:"Comment Subject Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	font-size:10.0pt;
	font-family:"Calibri",sans-serif;
	font-weight:bold;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-link:"Comment Text";}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-link:"Comment Subject";
	font-weight:bold;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-US link="#0563C1" vlink="#954F72" style='word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:20.0pt;line-height:107%'>Microservices-Based Online Store </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Video: </span><a
href="https://youtu.be/Mb2B3ByuvJ0" target="_blank"><span style='font-size:
14.0pt;line-height:107%'>https://youtu.be/Mb2B3ByuvJ0</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>GitHub Repo:
</span><a href="https://github.com/Ashot72/Microservices-based-Online-Store"
target="_blank"><span style='font-size:14.0pt;line-height:107%'>https://github.com/Ashot72/Microservices-based-Online-Store</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>I built an Online
Store Next.js (React) app using Microservices.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=745 height=492 id="Picture 2"
src="index_files/image001.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 1</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:107%'>The
monolithic architecture</span></b><span style='font-size:14.0pt;line-height:
107%'> is considered to be a traditional way of building applications. A
monolithic application is built as a single unit.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Usually, it
is based on a client-side user interface, a server-side application and a
database. Normally monolithic applications have one large</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>code base
and lack modularity. If developers want to update or change something, they
access the same code base. They make changes in the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>whole stack
at once.</span></p>

<p class=MsoNormal><img border=0 width=745 height=488 id="Picture 3"
src="index_files/image002.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 2</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>While a
monolithic application is a single unit, a <b>microservices architecture </b>breaks
it down into a collection of smaller independent units. These</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>units carry
out every application process as a separate service. All the services have
their own logic and the database as well as perform the specific</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>functions.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Pros of
Microservices</span></i></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Scaling
up becomes easier</span></i><span style='font-size:14.0pt;line-height:107%'> -
In the microservices architecture each service is designed, developed and
deployed independently. The entire system</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>need not be
taken down and deployed again.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Leads to
Improved Fault Tolerance -</span></i><span style='font-size:14.0pt;line-height:
107%'> Applications within microservices could continue working even if one
service fails. Failure of one microservice</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>does not
affect the working of others. </span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Ease of
understanding of the <a>codebase of the software system</a><span
class=MsoCommentReference><span style='line-height:107%'><a class=msocomanchor
id="_anchor_1" onmouseover="msoCommentShow('_anchor_1','_com_1')"
onmouseout="msoCommentHide('_com_1')" href="#_msocom_1" language=JavaScript
name="_msoanchor_1">[LTA1]</a>&nbsp;</span></span></span></i><span
style='font-size:14.0pt;line-height:107%'> - As one module has one
responsibility encapsulated within, it becomes</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>easier to
understand the code base for that module.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Gives you
scope for experimenting with different technologies­</span></i><span
style='font-size:14.0pt;line-height:107%'> - Developers have the flexibility to
experiment with different technologies</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>while
creating various services.<i> </i></span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Independent
Deployment of each module</span></i><span style='font-size:14.0pt;line-height:
107%'> - Since microservices are separate modules, they can be deployed independently
in any application.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If any
module is modified, then the entire application need not be rebuilt and
deployed.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Cons of
Microservices</span></i></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Increased
Complexity of Communication Between the Services</span></i><span
style='font-size:14.0pt;line-height:107%'> - Splitting an application into
multiple smaller modules increases the communication overhead.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Developers
have to be extra cautious while handling requests between the different
modules.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Requires
More Resources</span></i><span style='font-size:14.0pt;line-height:107%'> -
With an increasing number of microservices, the resources needed to implement
them increases as well.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Global
Testing and Debugging is Difficult </span></i><span style='font-size:14.0pt;
line-height:107%'>- With microservices-based applications, each service needs
to be launched and tested individually first.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Then the
application as a whole need to be tested again, once all the services are
launched.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Not
Practical for Small Applications</span></i><span style='font-size:14.0pt;
line-height:107%'> - Microservices architecture is a good option for bigger
applications. But, for smaller apps, it will probably be more</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Time
consuming and challenging to implement.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Relatively
Complex Deployment</span></i><span style='font-size:14.0pt;line-height:107%'> -
The deployment could be complicated and challenging procedure. It would need
coordination between multiple services during</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>deployment.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:107%'>Docker</span></b></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>What is
Docker?</span></i><span style='font-size:14.0pt;line-height:107%'> - Docker is
an open-source containerization platform. It enables developers to package
applications into.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Why use
Docker?</span></i><span style='font-size:14.0pt;line-height:107%'> - Docker
makes it really easy to install and run software without worrying about setup
or dependencies.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=386 height=311 id="Picture 94"
src="index_files/image003.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 3</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Docker
image</span></i><span style='font-size:14.0pt;line-height:107%'> Is a file used
to execute code in a Docker container.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>A Docker
image packs up the application and environment required by the application to
run, and a container is a running instance of the image.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Install
Docker desktop for windows <a
href="https://docs.docker.com/desktop/install/windows-install/" target="_blank">https://docs.docker.com/desktop/install/windows-install/</a></span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The <i>Docker
client</i> provides a command line interface (CLI) that allows you to issue
build, run, and stop application commands to a Docker daemon.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The main
purpose of the Docker Client is to provide a means to direct the pull of images
from a registry and to have it tun on a Docker host.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:107%'>Kubernetes</span></b></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Kubernetes</span></i><span
style='font-size:14.0pt;line-height:107%'> - is a tool for running a bunch of
different containers together. It will automatically manage the creation and
management all of these different containers.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>It is also
going to make it really easy for us to communicate between these containers as
well.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1295 height=761 id="Picture 4"
src="index_files/image004.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 4</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Enabling
Kubernetes on Docker for Windows.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1168 height=723 id="Picture 5"
src="index_files/image005.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 5</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In our
project we have create Docker images. Here we are in <i>client </i>folder and
create a docker image by running <i>docker build. </i></span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1091 height=441 id="Picture 6"
src="index_files/image006.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 6</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Once it is created,
we push it to Docker Hub by running docker push ashot72/client.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1132 height=587 id="Picture 7"
src="index_files/image007.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 7</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If you
navigate to Docker hub </span><a href="https://hub.docker.com/" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://hub.docker.com</span></a><span
style='font-size:14.0pt;line-height:107%'> and search for <i>ashot72</i> you
will see our Online Store project images.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=880 height=363 id="Picture 10"
src="index_files/image008.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 8</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>This is auth
(authentication) service.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img width=561 height=171 src="index_files/image009.png"
align=left hspace=12><span style='font-size:14.0pt;line-height:107%'><br
clear=all>
</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 9</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We took all
Auth files and Dockerfile and fed them into Docker and this is an image for
Auth service. Now we can create as many instances of this image or containers
as we wish.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=861 height=291 id="Picture 104"
src="index_files/image010.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 10</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Whenever we
want to use Kubernetes, we have to have a set of images that are already ready
to go. We are going to create a container of this thing at some point in time.
We want to deploy it</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>into our
Kubernetes cluster. We have three separate Nodes. Node is a virtual machine. It
is an essentially a computer that is going to run some number of containers for
us. If you are running</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Kubernetes
on your own computer, it is extremally likely that you are only running one
Node by default. So, you have one virtual machine. It is only once you start
deploying to some cloud provider </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>you may have
multiple Nodes.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=861 height=401 id="Picture 105"
src="index_files/image011.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 11</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>To create a
container out of the Auth image, we are going to first create a configuration
file. In the configuration file we are going to list out some very explicit
directions for Kubernetes.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to say, please run 2 copies of the Auth image for us, make containers and host
them somewhere on these Nodes. Inside that config file we are also going to say
please</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>allow copies
of Auth to be accessible. Kubernetes is going to look at your local machine and
see if there is a copy of that image already. If it is not available then it
will default to looking out </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>at Docker
Hub and try to find a copy of that image there instead.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=691 height=361 id="Picture 1"
src="index_files/image012.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 12</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When
Kubernetes finds the image, it is creating two containers because we asked for
two, and randomly distributes it among these Nodes.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Each
container that it is created is going to be hosted, or essentially created
inside of something called a <i>Pod</i>. So, each container is going to create
2 Pods and each of them is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>going to
have a copy of the Auth container running inside of it.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=691 height=451 id="Picture 9"
src="index_files/image013.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 13</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In order to
manage these two Pods, Kubernetes is also going to create something called a
deployment. The deployment is going to read the configuration file and creates
two copies of the Auth image.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The
deployment is going to be in charge of managing both these Pods, if anything
ever goes wrong with these Pods. If Pod crashes for some reason or if it just
stops running or whatever else might</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>possibly
happen this deployment is going to make sure that pos automatically gets
recreate it for us.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=691 height=531 id="Picture 12"
src="index_files/image014.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 14</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Now, it is
the second step here in the config file (Figure 11) Please allow us to access
these services from other Pods or essentially containers inside of our
Kubernetes cluster. To do so Kubernetes is going</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>to create
something else called a <i>service</i>. <i>Service</i> is something that gives
us access to running Pods or running containers inside of our cluster. It is
handling networking among different micro services.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1113 height=536 id="Picture 18"
src="index_files/image015.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 15</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Kubernetes
terminology.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to create Kubernetes config files which will include Deployments, Pods,
Services (referred to as Objects). It is written in YAML file.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The config
files we are going to create are really documentation of what our Kubernetes
cluster is doing.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=868 height=392 id="Picture 19"
src="index_files/image016.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 16</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The <i>kind </i>of
object that we are trying to create is <i>Deployment</i>. We setup some <i>metadata
</i>and we are just going to assign some name to it, <i>auth-depl</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>After that
we will put in <i>spec</i> section which is going to specify exactly how this
deployment should behave. The first property here is <i>replicas</i> with <i>1</i>
which is the number of pods we want to create running</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>some
particular image. Next is <i>selector</i> then <i>matchLabels </i>and then <i>app</i>
<i>auth.</i> Then we have <i>template</i> then <i>metadata, labels</i> then <i>app
auth</i>. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=868 height=392 id="Picture 20"
src="index_files/image017.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 17</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>These two
sections right here the <i>selector </i>thing and this <i>metadata</i> thing
below really working together. A deployment kind of has a hard time figuring
out which pods is should manage inside of our cluster.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If a set of
pods get created, we have to somehow give the deployment some information and
tell it that these pods over here you need to manage. That is the goal of this
selector and metadata labels app</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>thing is all
about.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The <i>selector
</i>is saying take a look at all the different pods that have been created by
an all the pods with a label of <i>app auth</i>. The <i>template </i>is where
we specify the exact configuration of a pod that we want</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>this
deployment to create. Configuration below <i>template</i> is some configuration
that is going to be applied to the pod that the deployment is going to make. We
want the pod to have a label of <i>app</i> <i>auth</i>. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>After that
we set up a <i>spec</i>. Everything inside the <i>template</i> can be really
thought of as a pod spec or a pod config file. We have one <i>container</i>
which should have a <i>name</i> of <i>auth </i>and should run image of our</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>docker id
which is <i>ashot72/auth. </i>To apply this config file, we will run <i>kubectl
apply -f auth-depl.yaml </i>command. After it the deployment should be crated.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Next, we are
going to make use of services to set up some communication between all of our
different pods or to get access to a pod from the outside of our cluster
(Figure 14).</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1080 height=425 id="Picture 21"
src="index_files/image018.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 18</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Types of
Services.</span></p>

<p class=MsoNormal><img border=0 width=691 height=431 id="Picture 79"
src="index_files/image019.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 19</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If we want
to setup some kind of communication between these different pods inside of a
cluster the most appropriate service is <i>Cluster IP</i> type service because
it only exposes pods to other pods inside</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>the cluster.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=691 height=791 id="Picture 86"
src="index_files/image020.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 20.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If we want
to access a pod from the outside the world like a browser running on our
computer or some user</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s machine then in this scenario, we
can use either a <i>Node Port</i> or <i>Load Balancer</i>. If we are in a</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>development
environment and we just want to do a quick test or something like that we would
use a <i>Node Port </i>but in just about every other scenario we are going to
use a <i>Load Balancer</i> type service.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1053 height=609 id="Picture 24"
src="index_files/image021.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 21</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to write out the configuration to create this new <i>Cluster IP </i>service
where <i>kind</i> is <i>Service</i>. <i>Metadata</i> is going to have <i>name</i>
<i>auth-srv</i></span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Then we
create a <i>spec</i> to setup a selector that is going to tell the service what
pods it is going to allow to access to. In this case we want to use or we want
to make sure that we tell the service to direct any</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>incoming traffic
to the pod with a label of <i>app auth-srv</i> that is going to be the label
that we are going to look for so we will provide that label to the <i>selector</i>
field. We can optionally specify <i>type </i>ClusterIP. If</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>we do not
specify a type for the service, Kubernetes will default to creating a ClusterIP
service. Finally, we set up our <i>port</i> which is <i>3000</i> and <i>targetPort</i>
<i>3000</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Now we can run
<i>Kubectl apply -f auth-depl.yaml </i>command.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></i></p>

<p class=MsoNormal><img border=0 width=1249 height=541 id="Picture 25"
src="index_files/image022.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 22</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>There are
two distinct things in the world of Kubernetes. The first one is called <i>Load
Balancer Service</i>. There is something that is closely related that is
referred to as ingress or <i>Ingress</i> or <i>Ingress Controller</i>. </span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Load
Balancer</span></i><span style='font-size:14.0pt;line-height:107%'> <i>Service</i>
is going to be something that tells Kubernetes or specifically our cluster to
reach out to its provider and provision a load balancer. The goal of a load
balancer service is to get traffic</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>into a
single pod. On the other hand, an <i>Ingress</i> or <i>Ingress Controller</i>
is a pod that has set of routing rules in it that are going to distribute
traffic to other services inside of our cluster.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=611 height=481 id="Picture 117"
src="index_files/image023.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 23</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to imagine that we are running one singular pod in our cluster. Our cluster at
some point time in the future is going to be running on some cloud provider,
such as AWS or something similar.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to somehow get traffic or network requests from the outside world to some pod
inside of our cluster. How do we do that using a load balancer? We will create
a config file for a load balancer</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>service. We
will then feed that thing into our cluster using that same <i>kubectl apply</i>
command. Load balancer service is a very special little thing just about all
the objects we have been discussing. All our</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>stuff has
been created inside of our cluster. We have created services inside the
cluster, pods inside the cluster, deployments inside the cluster. A load
balancer service is a little bit different. A load balancer</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>service is
going to tell our cluster to reach out to its cloud provider. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=611 height=481 id="Picture 119"
src="index_files/image024.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 24</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>A Load
balancer exists completely outside of our cluster. It is part of Google Cloud, AWS.
etc. Load balancer is going to be used to take traffic from the outside world
and direct it to some pod inside of our</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>cluster.
Load Balancer itself is not super useful right now. We want to get traffic
distributed to a set of different pods and have some routing rules inside of
something to decide where to send the traffic to.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Load
Balancer is not doing everything we need and that is where this idea of an
Ingress or Ingress Controller is going to come into play. Ingress or Ingress
Controller is a pod that has a set of routing rules</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>inside of
it. It is going to work alongside the load balancer service thing.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=611 height=361 id="Picture 121"
src="index_files/image025.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 25</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We want to
get some outside traffic into these set of different pods. We are going to have
a request coming into a Load Balancer that has been provisioned with a cloud
provider. The Load Balancer is going</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>to send that
request onto this Ingress or Ingress Controller. Ingress Controller should have
a set of routing rules inside of it. The controller is going to look at the
path of the incoming request and then</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>decide based
upon that path whether to send the request onto that pod or another one. When
we say send the request onto some pod, we mean sending it to some cluster IP
service that it is sending</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>request onto
that pod.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>The Load
Balancer is just about getting traffic into our cluster.</span></i></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>The
Ingress Controller is about routing rules or having some routing configuration
that is going to send requests off to the appropriate pod.</span></i></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to making use of a project called <i>ingress-nginx </i></span><a
href="https://kubernetes.github.io/ingress-nginx/deploy/" target="_blank"><i><span
style='font-size:14.0pt;line-height:107%'>https://kubernetes.github.io/ingress-nginx/deploy/</span></i></a><i><span
style='font-size:14.0pt;line-height:107%'> </span></i><span style='font-size:
14.0pt;line-height:107%'>. <i>This is a project that will create a Load
Balancer Service plus an Ingress for us.</i></span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></i></p>

<p class=MsoNormal><img border=0 width=1204 height=656 id="Picture 29"
src="index_files/image026.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 26</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>To install
ingress-nginx we run the following command kubectl apply -f </span><a
href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml"><span
style='font-size:14.0pt;line-height:107%'>https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=896 height=738 id="Picture 30"
src="index_files/image027.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 27</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If you open
the deploy.yaml file you will see <i>kind</i> <i>Deployment</i>. We know that
deployment creates and manages a set of pods.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>It is
creating something that is called a <i>nginx-ingress-controller</i>. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=887 height=814 id="Picture 31"
src="index_files/image028.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 28</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In the same
file if we scroll down, we will see a config that makes a service of type Load Balancer.
</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=611 height=361 id="Picture 122"
src="index_files/image029.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 29</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are
essentially implementing this diagram be means of deploy.yaml config file.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have now
created an Ingress Controller through Ingress and connects inside of our
cluster. We need to teach a couple of routing rules and tell it how to take
incoming requests and send them off to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>some
appropriate pods. We are going to do that by writing a config file that is
going to contain some route rules. We will then feed that into our cluster
where it will be automatically discovered by the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Ingress
Controller.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1097 height=610 id="Picture 33"
src="index_files/image030.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 30</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We create
ingress-srv.yaml to write some more config. The entire <i>annotations </i>section
is what is going to help the Ingress Controller to understand that we are
trying to feed some routing rules. Next up we</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>are going to
put our spec together. Inside the spec we will have rules.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Rules is
going to have all the different routing rules that we want to apply to teach
the Ingress Controller how to take incoming traffic and route them up to our
different pods. <i>Rules</i> is going to be an array.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Then we
write <i>host </i>as <i>onlinestore.com</i> (will discuss it soon). Then we
write <i>http</i>, <i>paths</i>, <i>path</i>. The first routing rule that we
are going to set up is going to take incoming traffic and send it off to auth
service. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1131 height=777 id="Picture 34"
src="index_files/image031.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 31</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to make sure that if any requests are coming into our application with a path
of slash <i>users</i> then it is sent to auth microservice.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1205 height=851 id="Picture 35"
src="index_files/image032.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 32</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>servicename</span></i><span
style='font-size:14.0pt;line-height:107%'> and <i>port</i> <i>number</i> match
the entries specified in the service section of auth-depl.yaml.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=521 height=221 id="Picture 124"
src="index_files/image033.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 33</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When we make
use of Kubernetes, we can absolutely just host one single application at one
single domain. With Kubernetes we can also host a ton of infrastructure. We are
not necessarily limited</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>to just
hosting one singular application. We can host many different apps at many
different domains inside of a single Kubernetes cluster. We could have some app
tied to onlinestore.com, another totally</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>different
app such as shop.com .etc. The infrastructure for all these different
applications at these different domains can be hosted inside of one single
Kubernetes cluster. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=855 height=532 id="Picture 37"
src="index_files/image034.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 34</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Ingress-nginx
setup is assuming that you might be hosting many different apps at different
domains. So that is what this host property is all about. We are saying that
the config section that we are about to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>write in the
section below <i>-host</i> is all ties to an app hosted at onlinestore.com</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In the
development environment we are used to accessing all of our different running
servers at localhost. In a development environment what we have to do is trick
our local machine into thinking that</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>onlinestore.com
is equivalent to localhost. In other words, whenever we try to connect to
onlinsetore.com we are going to trick our computer to connecting to our local
machine rather than the real</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>onlinestore.com
that may exist out there somewhere online. To trick our local machine into
connecting to local host whenever we go to onlinsetore.com we are going to make
a little configuration change</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>on our
computer to our host file. In the host file we can set up a series of
additional little routing rules. We can say any time anytime they try to go to
onlinestore.com instead just connect to our local</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>machine.</span></p>

<p class=MsoNormal><img border=0 width=1049 height=602 id="Picture 38"
src="index_files/image035.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 35</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>On Windows
Host file location is C:\Windows\System32\drivers\etc and we just have to add
one line <i>127.0.0.1 onlinestore.com</i> in hosts file.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Whenever you
try to connect to onlinestore.com you are connecting to the local machine at
127.0.0.1</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=571 height=285 id="Picture 40"
src="index_files/image036.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure36</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Here we are
able to access to auth pod with routing with very normal URL. Behind the scenes
ingress-nginx is going to take this request, route it off to the appropriate
service and that service in turn is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>going to
read it off to the appropriate pod.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>There are
steps we go through any time we want to change an image that is used by a
development.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Updating an
image, we should do the following</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The
deployment must be using the <i>latest</i> tag in the pod specification.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Make an
update to your code.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Build the
image.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Push the
image to docker hub.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Run the
command - <i>kubectl rollout restart deployment [depl_name]</i></span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have to
rebuild the image, push it to Docker hub and then run a command. It is
nightmare to do that and it would result in a very unpleasant development
process. We are developing code actively</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>inside of a
Kubernetes cluster. We are going to instead use a tool called <i>Skaffold</i>.
Skaffold is a command line tool that we are going to use to automatically do a
lot different tasks in our Kubernetes dev</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>environment specifically.
You cannot use Skaffold in a production environment. Skaffold makes it super
easy to update code in a running pod. Another advantage is that it makes it
very easy for us to create</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>and delete
all the different objects that are tied to some project.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1082 height=506 id="Picture 41"
src="index_files/image037.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 37</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>You can
install Skaffold from </span><a href="https://skaffold.dev/" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://skaffold.dev</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1035 height=705 id="Picture 42"
src="index_files/image038.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 38</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to configure Skaffold by writing out another config file. It will tell Skaffold
how to manage all the different sub projects. What we write inside of
scaffold.yaml does not applied to Kuberneties,</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>instead, it
just consumed Skaffold directly and Skaffold is a tool that runs outside of our
cluster. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=903 height=618 id="Picture 43"
src="index_files/image039.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 39</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>This section
tells the Skaffold that there is a collection of different config files
intended for Kubernetes inside the infra/k8s directory. By adding in this
manifest line, we are telling Skaffold that we want to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>watch all
these different yaml files. Anytime that we make a change to one of those files
Skaffold is going to automatically reapply that config file to our Kubernetes
cluster. In other words, it will save us</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>from the
hassle of having to run kubectl apply -f over and over again any time that we
create a file or make a change to a file. By listing out manifests Skaffold is
also going to make sure to create all these or</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>apply all
these anytime that we start scaffold up. It is also going to delete all the
config or all the objects associated with these config files whenever we stop
scaffold as well. In total it is doing three things.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We start up
scaffold, apply these files when me make a change, apply these files whenever
we stop scaffold, find all the objects related to these config files and delete
the objects. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Next section
is <i>build</i>, <i>local</i>, <i>push</i> <i>false</i>. By default, whenever
scaffold makes a change to one of our images or rebuild an image, it is going
to try to push it up to Docker Hub. That is not actually required</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>when we are
using scaffold. So, we are going to disable it by default behavior.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=936 height=536 id="Picture 46"
src="index_files/image040.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 40</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Next section
is <i>artifacts</i>. Artifacts section is telling scaffold about something
inside of a project that it needs to maintain. Especially saying that there is
going to be some pod that is running code out of the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>client
directory inside of our project. Whenever something changes inside this directory,
scaffold is going to try to take those changes and somehow update our pod.
There are two ways in which scaffold is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>going to try
to update our code. First off, if we make a change to a typescript file as
indicated by this **/*.tsx then skaffold will take that change file and
directly throw it into our pod. Our pod is going to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>have the
latest code inside of it. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1035 height=631 id="Picture 47"
src="index_files/image041.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 41</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Whenever
something changes inside this client directory, scaffold is going to try to
take those changes and somehow update our pod. There are two ways in which
scaffold is going to update our pod. First</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>off, if we
make a change to a Typescript file as indicated by **/*.tsx match then scaffold
will take that changed file and just directly throw it into our pod. If we make
any change inside the client directory</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>that is not
matched up by **/*.tsx rule then scaffold is going to rebuild the entire image.
Imagine installing a new dependency into our client project.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Whenever we
install a new dependency skaffold is going to update our package not just one
file. It is going to decide to completely rebuild our image and update the
deployment tied to it.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=639 height=782 id="Picture 48"
src="index_files/image042.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 42</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>To start
skaffold up you just run <i>skaffold dev</i></span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=832 height=581 id="Picture 76"
src="index_files/image043.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 43</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to have a React client application that is going to be in charge of showing
some content inside the browser. The React application is going to be built
using Next.js. Next.js is a server side</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>rendering
react framework. We are then going to have Auth, Products, Cart, Payments and
Expiration services that are all going to be essentially simple node servers.
Each one of them is going to be</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>running
Express server. Each of these different services will have some persistent storage
in the form of Mongo DB, one database per service. Expiration service on the
other hand is going to be making use</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>of Redis.
Each of these different services are going to be making use of a shared <i>Common</i>
library. Common is an NPM module to share a bunch code among these different
services. Finally, as an event bus</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>we are going
to be using NATS Streaming Server.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1271 height=301 id="Picture 125"
src="index_files/image044.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 44</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>MongoDB is
just like any other thing should be running inside of our Kubernetes cluster.
We are going to tun MongoDB inside of a pod. We usually do not create pods
directly. We make use of deployments.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The
deployment is going to create a pod for us. To communicate with this pod, we
are going to have to create a Cluster IP service. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1266 height=842 id="Picture 52"
src="index_files/image045.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 45</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>You can see
that in this case in our auth-mongo.depl.yaml file <i>kind</i> is not <i>Deployment</i>
but <i>StatefulSet</i> and we also have <i>kind</i> of <i>PersistentVoume</i>
and <i>PersistentVolumeClaim</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Users
register and login to our online store and their credentials should persist in a
Mongo DB database pod (Figure 44). Data gets added, updated in the database, we
create a new user etc. but by default</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>when you
restart the pod all those changes will be gone because Kubernetes does not give
you data persistence out of the box. That is something that we have to
explicitly configure for each application</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>that needs
saving data between a pod restart. Basically, we need a storage that does not
depend on the pod lifecycle. It will still be there when pod dies and new one
gets created, so the new pod can pick</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>up where the
previous one left off. It will read the existing data from that storage to get
up-to-date data. However, we do not know on which node the new pod restarts so
our storage must also be</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>available on
all nodes, not just one specific one. When the new pod tries to read the
existing data, the up-to-date data is there on any node in the cluster. Also,
you need a highly available storage that will</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>survive even
if the whole cluster crashed.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We can
configure any type of storage using Kubernetes component called <i>Persistent
Volume</i>. We can think of persistent volume as a cluster resource just like
RAM or CPU that is used to store data.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Persistent
Volume is just an abstract component it must take the storage from the actual
physical storage, like local hard drive, cluster nodes or an external NFS
servers or a cloud storage like AWS.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=448 height=859 id="Picture 53"
src="index_files/image046.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 46</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Persistent
Volume is very basic object it has a name, you can apply some labels to it, you
can apply a capacity and, in this case, I am giving it one gigabytes of
storage. I am giving the permission to say I have</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>read/write
access and I define hostPath where I want the volume to be mounted to on the
host operating system machine.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Persistent
Volume becomes a little bit more complicated because of the <i>Storage Class</i>.
In the yaml file (Figure 46) we refer to a storage class as <i>storageClassName:
hostpath</i>. There is a number of different</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>storage
classes in Kubernetes. In our case the storage class name is <i>hostpath</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Hostpath is
a specific type of storage in Kubernetes. It is a very basic local storage
where we mount the host drive into our pod as a persistent volume. We can see I
have a host type of storage because I am</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>running
docker for Windows which is automatically hosted for me so I can mount stuff on
the local host machine into the container as a persistent volume.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=971 height=171 id="Picture 54"
src="index_files/image047.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 47</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>To get the
storage class that are available in your cluster you run <i>kubectl get
storageclass</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=497 height=871 id="Picture 55"
src="index_files/image048.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 48</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In
Kubernetes there is a thing called <i>Persistent Volume Claim. </i>That is way
for us to claim or allocate pieces of that storage to different pods and
services running in Kubernetes. It is a great way for a</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>developer to
say I want a piece of that storage without having to know how the storage is
provisioned without to know the credentials and the security around the
storage. Persistent Volume Claim is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>simply
reference to the persistent volume to be used and indicates how much storage
you want to use from that volume.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=421 height=581 id="Picture 56"
src="index_files/image049.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 49</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>As you see
we specified <i>image: mongo</i> but where does it come from? </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1208 height=451 id="Picture 57"
src="index_files/image050.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 50</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>It comes
from Docker Hub for public use. This is an officially hosted image that we can
run to get a Mongo DB database.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Authentication</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are now
considering a user to be signed in. That means we need to somehow generate a Cookie
or Web Token and send it back to the user to use that token to access other
services inside of</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>application.
Web Tokens and Cookies are not the same thing.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=831 height=431 id="Picture 127"
src="index_files/image051.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 51</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We got some
browser making a request over to some server. When the server sends a response
backwards to the browser it can optionally include a header of set cookie and
then for that set cookie</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>header it
can provide some kind of value., say, 123. That piece of information is going
to be automatically stores inside the browser. Then whenever this browser makes
a follow up request to the same</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>domain with
the same port the browser, the browser is going to make sure that it takes
little piece of information right there and appends it onto the request as a
cookie header. So that information will be</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>automatically
sent over to the server.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>With a JSON
web token, we are going to take some arbitrary piece of information that we
refer to as the payload. This can be some kind of object that has maybe a user
Id etc. We are going to take that</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>payload and
throw it into a JSON web token creation algorithm.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If payload
is something like {userId: </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>122</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>, color: </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>red</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>}
then the encoded string JWT may look like </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>1231hkjhk12jg1rwdsd2xwide</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'> stored
inside. </span><span style='color:black'>'</span><span style='font-size:14.0pt;
line-height:107%'>1231hkjhk12jg1rwdsd2xwide</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'> is that original payload. We can</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>take </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>1231hkjhk12jg1rwdsd2xwide</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>
throw it into some kind of decoding algorithm and extract the original object. So,
at any point time we can always access the information that is stored inside.
Once we</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>have this token,
we eventually do need to communicate it between the browser and the server. We
take that web token and store it inside of a cookie as well. The JSON web token
will be managed</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>automatically
by the browser included on all follow up requests.</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>Cookie</span></i></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Transport
mechanism</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Moves any
kind of data between browser and server</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Automatically
managed by the browser</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>JWT</span></i></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Authentication/Authorization
mechanism</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Stores and
data we want</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have to
manage it manually</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Because we
are doing server-side rendering and because the first request needs to have
authentication and because we cannot customize that request in any way to try
to attach on an additional header or some information inside the body, we have
to communicate our JSON web token inside of a cookie.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=923 height=617 id="Picture 61"
src="index_files/image052.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 52</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to sign up in Postman. We successfully signed up.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=590 height=695 id="Picture 62"
src="index_files/image053.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 53</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If we go to
the Cookies tab now, we will see that a cookie has been set. So, this is our
actual JSON web token. Actually, this is a base64 encoded JSON web token. To
get the actual JSON Web token we</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>should do
just a little bit of work.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1137 height=703 id="Picture 63"
src="index_files/image054.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 54</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We go to </span><a
href="http://base64decode.org/" target="_blank"><span style='font-size:14.0pt;
line-height:107%'>http://base64decode.org</span></a><span style='font-size:
14.0pt;line-height:107%'> This is a little tool that can take a base 64 string
and decode it into plain UTF 8. You see we have </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>jwt</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'> property and inside that string
which is the actual JSON web token.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1208 height=663 id="Picture 64"
src="index_files/image055.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 55</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>I am taking
that token, go to </span><a href="http://jwt.io/" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>http://jwt.io</span></a><span
style='font-size:14.0pt;line-height:107%'> which is a web site just to help
explore a JSON web token. We put our JSON web token and made sure that it was properly
decoded.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We type
onlinestore.com in our browser which makes a request off to some networking
layer on our computer. We setup up our host file (Figure 35) to translate
onlinestore.com into localhost (127.0.0.1)</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>with the
default port of 80. That port on local host has been bound to by Ingress Nginx.
</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=744 height=623 id="Picture 8"
src="index_files/image056.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 57</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Any time you
make a request to that IP address and port Ingress Nginx is going to receive
that request and route it properly.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1407 height=401 id="Picture 130"
src="index_files/image057.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 58</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>So, in this
case because we are making a request to an onlinstore.com without any path on
there, Ingress Nginx decided to send that request on to our client application
(1). Next.js built up some HTML</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>document and
sent it back down to us (2). We are not actually fetching any data inside of
this initial approach but there might have been some initial HTML inside there.
Our browser took that HTML file</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>and rendered
it (3). It might have also fetched some additional JavaScript files and then
eventually we had some code inside our React application that made use of Axios
to make a follow-up request.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We made a
request and we specifically designated a path only. We say make a request to
just to <i>/api/users/currentuser </i>(4). We do not specify a domain, just a
path. Whenever we try to make a request and</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>we do not
specify the domain, by default our browser is going to assume that we are
trying to make a request to the current domain (5). If you look at the
successful user request at your browser</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s header</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>tab you will
see that the final request URL that the browser decided to use is </span><a
href="http://onlinestore.com/api/users/currentuser"><span style='font-size:
14.0pt;line-height:107%'>http://onlinestore.com/api/users/currentuser</span></a><span
style='font-size:14.0pt;line-height:107%'>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=701 height=504 id="Picture 11"
src="index_files/image058.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 59</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Even though
we typed into our code just <i>/api/users/currentuser </i>the browser expanded
that into <i>onlinestore.com/api/users/currentuser</i>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=706 height=580 id="Picture 14"
src="index_files/image059.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 60</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>This request
went through some networking layer on our computer and because of the config we
put into the host file (Figure 35) our computer decided to translate that into</span></p>

<p class=MsoNormal><i><span style='font-size:14.0pt;line-height:107%'>127.0.0.1/api/users/currentuser
</span></i><span style='font-size:14.0pt;line-height:107%'>(6). That got
forwarded into Ingress Nginx and it looked at the path on their which is /api/users/currentuser
and decided to forward that to Auth service (6). We got a</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>response
form the Auth Service and everything worked as expected (7).</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Now let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
make the same request from the server instead not from the browser.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=733 height=193 id="Picture 39"
src="index_files/image060.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 61</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In this case
you may see this error.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1255 height=240 id="Picture 59"
src="index_files/image061.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 62</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Here below, we
are talking about a separate auth module (not integrated into the project). Our
final project uses App component (_app.tsx) to initialize pages.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We enter
onlinestore.com into our address bar which makes a request to onlinestore.com.
That get translated by your computer because of hosts file setting pointing
127.0.0.1:80. That request goes to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Ingres Nginx.
Ingress Nginx takes a look at the path of that request. It decides to send it
to our default handler which is essentially our client service. The request was
handled inside of Next.js. Next.js takes</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>a look at incoming
request trying to see if there is any path on there or anything like that. If
it does not see one it will decide to show the root route essentially our
index.js (index.tsx) file. Whenever Next.js</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>is rendering
our stuff on the server and it is going to call that component</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
associated getInitialProps function. Inside there we write a code to make a
request to just /api/users/currentuser. We do not</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>specify a
domain so Next.js or precisely Axios attempts to issue that request. That route
goes through some networking layer once again. Networking in the diagram is
some HTTP stuff implemented by</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Node.js
layer and works similar to the browser. If we do not specify a domain in
/api/users/currentuser then Node</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s HTTP layer is going to just assume
that you are trying to make a request on your local</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>machine. So,
Node</span><span style='color:black'>'</span><span style='font-size:14.0pt;
line-height:107%'>s HTTP layer I going to automatically stick a domain on there
of possibly localhost:80 which is really 127.0.0.1:80. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are
running our Next.js application inside of a container. That container
essentially has its own little world. Try to make request to 127.0.0.1:80
inside of the container. It did not somehow get redirected</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>back out to
Ingres Nginx, instead it went to localhost inside of this container. There is
nothing running on port 80 inside that container right now. That is why we
received Figure 61 error. 127.0.0.1 error in</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 61 is
not talking about localhost on your personal machine. That is localhost inside
the container. Nothing is listening on localhost:80 inside the container.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In this case
we should also specify a domain but domain is going to be a little bit
complicated. The domain will be the name of service then a dot then the
namespace then svc.cluster.local such as</span></p>

<p class=MsoNormal><a href="http://NAMEOFSERVICE.NAMESPACE.svc.cluster.local"><span
style='font-size:14.0pt;line-height:107%'>http://NAMEOFSERVICE.NAMESPACE.svc.cluster.local</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The first we
need to understand is what is the name of the namespace. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=980 height=516 id="Picture 60"
src="index_files/image062.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 63</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We run
kubectl get namespace and see that the namespace is ingress-nginx. Now we need
to list out all the services that exist inside that namespace. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=977 height=509 id="Picture 65"
src="index_files/image063.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 64</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We type
kubectl get services -n ingress-nginx and see that the service name is
ingress-nginx-controller.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=761 height=521 id="Picture 66"
src="index_files/image064.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 65</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Here is how
we reach from our client across the namespace and access the service.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We need to
figure out whether we are inside the browser or the server when er are trying
to make a request in there, so we can adjust the domain accordingly.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1183 height=430 id="Picture 67"
src="index_files/image065.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 66</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Window is an
object that only exists inside the browser, it does not exist inside of Node.js
environment. If window is undefined then it means we are on the server otherwise
on the browser and request in</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>this case
can be made with a base url of </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>/</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1397 height=660 id="Picture 68"
src="index_files/image066.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 67</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When we
write some services it is common to have some common library to use inside
services. We need somehow share that library between multiple different
services.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will
share this common code as an NPM package. Anytime we change our common code we
are going to have to make our change pushing up to the NPM registry then go to </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>our
different services and update our version to the latest which is a tedious
process.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1329 height=631 id="Picture 69"
src="index_files/image067.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 68</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>For that reason,
we wrote out a little script that automated some of stuff for us.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=832 height=581 id="Picture 77"
src="index_files/image068.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 69</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>NATS
Streaming Server is an extremely performant, lightweight reliable streaming
platform built on NATS </span><a href="https://nats.io/" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://nats.io/</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>NATS implements
a publish-subscribe message distribution model for one-to-many communication. A
publisher sends a message on a subject and any active subscriber listening on
that subject receives the message.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img width=650 height=1 src="index_files/image069.png"
align=left hspace=12><span style='font-size:14.0pt;line-height:107%'><br
clear=all>
</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 70</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=772 height=768 id="Picture 78"
src="index_files/image070.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 71</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We create nats-deply.yaml
similar to others by specifying nats-streaming image getting from the Docker
Hub.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In our
project we will use node-nats-streaming client library </span><a
href="https://www.npmjs.com/package/node-nats-streaming" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://www.npmjs.com/package/node-nats-streaming</span></a><span
style='font-size:14.0pt;line-height:107%'> which is specifically designed to
work with the NATS Streaming Server.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If you
familiar with event emitter in Node.js where we emit events and listen to them
in plain JavaScript code that is really how this library works.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to create some objects, then setup some event listeners and emit events.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1141 height=641 id="Picture 83"
src="index_files/image071.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 72</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are using
node-nats-streaming to create events, send them over to that streaming server
and then that streaming server is going to send those out to our different
services which will be listening for events.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1458 height=635 id="Picture 84"
src="index_files/image072.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 73</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>NATS
Streaming requires to subscribe to specific channels. Channels or topics are
essentially types of events or channels of events that we are going to be
listening to specifically inside of our different</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>services.
For example, on a NATS streaming server we will create a collection of different
topics or channels. Whenever we want to emit some kind of event, we will create
it inside for one service. We will</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>reach out to
the NATS streaming library and we will tell it to publish this event to the </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>product:updated</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>
channel so that event will be emitted out of our Product Service. It will go
over to this channel on</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Node NATS
Streaming and then the event will be sent along to only the services that are
listening on that very specific channel. For example if our Cart Service is
listening for events on </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>product:updated</span><span
style='color:black'>'</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>then it will
receive a copy of that event. What if some other service such as Payment
Service was not listening to that channel it will not receive it.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=696 height=366 id="Picture 87"
src="index_files/image073.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 74</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>NATS
Streaming Server is going to store all the different events to get emitted in memory
by default. However, we can also customize it to store these events inside of
flat files stored on a hard drive or</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>even inside
of a database like MySQL or Postgres DB.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=696 height=506 id="Picture 88"
src="index_files/image074.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 75</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>For example,
Produce Service could emit an event over to the NATS Streaming Server and it
will be stored inside of the memory (1), and simultaneously a copy of that
event will be sent out to all the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>relevant
services (2). If we then at some point time bring a payment service or some
other new service online it can reach out the NATS Streaming Server ask for a
copy of all the different events and that</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>streaming
server will respond with all the relevant events that it has missed out on (3).</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=772 height=331 id="Picture 93"
src="index_files/image075.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 76</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We create a
new file called <i>nats-wrapper.ts</i>. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=779 height=802 id="Picture 90"
src="index_files/image076.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 77</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The goal of
this file is to create a NATS Client and behave as a singleton.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1040 height=729 id="Picture 91"
src="index_files/image077.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 78</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Index.ts
file is going to import that and make sure that we have some code inside there
to actually initialize that NATS Client and connect to that Streaming server.
We also have some code inside there to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>make sure
that if we ever lose our connection to NATS or if we are about to shut down our
application, we did go through some graceful shutdown process. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1346 height=639 id="Picture 92"
src="index_files/image078.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 79</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>So, we are
going to do initialization of that thing inside of index.js and then we will
also be able to import that initialized client into our ProductCreated Route
Handler and make use of it inside the Route</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Handler
itself.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1243 height=746 id="Picture 45"
src="index_files/image079.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 80</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When we
create NATS Client subscription we specify some subscription options.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>setDeliverAllAvailable
- Configures the subscription to replay from first available message. When we
create a subscription at some point time in the future, we can set
setDeliverAllAvailable option to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>somehow grab
or get the list of events that have been emitted at some point in the past.
This is handy for making sure that if a service ever goes down, we can somehow
get a list of all the events that have</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>been emitted
in the past. The only downside here is that we are going to be redelivered our
big list of events after we have been running our application for possibly
weeks, months or years. Usually, we do</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>not use this
setDeliverAllAvailable by itself. Instead, we are going to use this option
along with one other option (setDurableName) that is going to give us some more
desirable behavior.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>setDurableName()
- Sets a durable subscription name that the client can specify for the
subscription. This enables the subscriber to close the connection without
canceling the subscription and resume the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>subscription
with some durable name. Note the server will resume the subscription with
messages that have not been acknowledged. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
imagine we created a durable subscription with a name abc setDurableName(abc).
When we create that subscription NATS internally inside of the channel that we
are subscribing to or listening to is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>going to
create a record listing all the different durable subscriptions that we have.
Then whenever we emit an event NATS is going to record whether or not this
subscription has received and successfully</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>processed
that event. When a service is not available NATS is going to keep a record of
all the different events that abc has missed out on. Whenever the service comes
back online and reconnects with the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>same exact id
(abc) NATS is going to take a look at that subscription id (durable name) and
it is going to say, OK you have already processed abc event. When it is
processed it will be marked as processed.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=890 height=682 id="Picture 49"
src="index_files/image080.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 81</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>setManualAckMode
- Subscriptions can use auto-ack or manual-ack. Auto-ack is the default for
most clients. Manual ack provides more controls.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We try to
save some data to a database and fail entirely. Maybe we temporarily lose our
connection to database, maybe the database is down for some kind of upgrading
etc. Let</span><span style='color:black'>'</span><span style='font-size:14.0pt;
line-height:107%'>s just imagine that as we</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>try to save
data we failed with some kind of error. Any time an event is received by a
subscription it is automatically marked as we received that event. We do not
get some follow up opportunity to process</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>it again. By
setting setManualAckMode(true) the node streaming library is no longer going to
automatically acknowledge or tell the NATS Streaming library that we have
received the event and instead it</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>will be up
to you to run some processing on that event, possibly save some information in
the database then after that entire process is complete, we will then
acknowledge the message. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Queue Groups
- allow scaling of services horizontally. Subscriptions for members of a queue
group are treated as a single service. When you send a message to a queue group
subscription, only a single</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>client in a
queue group will receive it.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=392 id="Picture 51"
src="index_files/image081.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 82</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>This is a
diagram showing where all events are coming from and where they are going to.
For the product created event, we need to make sure that the cart service
receives this event or listens for product</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>created.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=302 id="Picture 72"
src="index_files/image082.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 83</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have some
notes here about what the listener needs to do. The Cart service needs to
listen for product: created. We have got product created event coming to Cart
Service. The reason we are listening</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>for this
event inside Cart service is so we can take the information about the product
that we have just created and save it in the local Products collection. This is
a classic example of data replication</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>between
different services. We are saving this information about a product so that when
the Cart Service needs to know some details about a product, it does not have
to do synchronous communication</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>over to the
Product Service to learn about the different products that are available. So,
all we really need to do is pull off some information about the product that
was just created and save it to our local</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Products
collection.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=261 id="Picture 73"
src="index_files/image083.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 84</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>The Cart
service also needs to know for product updated.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=262 id="Picture 74"
src="index_files/image084.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 85</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Likewise,
the Cart service should know when a product is being added to a user</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
shopping cart.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=681 height=291 id="Picture 123"
src="index_files/image085.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 86</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Expiration
Service needs to know when a product is selected. We will talk about Expiration
Service.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=282 id="Picture 81"
src="index_files/image086.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 87</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We need to
make sure that inside Payments Service listens for the order created event. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=622 height=262 id="Picture 82"
src="index_files/image087.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 88</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When a
payment is created then a user</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s items should be removed from his/her
shopping cart.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=681 height=280 id="Picture 70"
src="index_files/image088.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 89</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When 15-second
interval timer is timed out it is notified to Product Service (we will talk
about Expiration Service). </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>When we
update a product information, say, the price of a product, it is notified to
the Cart Service (Figure 84). We may face a problem as communication between
services is asynchronous.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Suppose, I
updated a product price to $5 then $10. I expect that Cart Service will receive
$10 as it is my final update. As communication between services is not
synchronous then it may happen that</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>my second
update $10 may arrive first then $5 and the product price information in the
Product collection of the Cart Service will be $5 which is not we expect.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 95"
src="index_files/image089.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 90</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to make the series of three requests. We are going to first create a product
and give it a price of 10 then 15.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 97"
src="index_files/image090.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 91</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will
start the product to a price of 5, so inside of our Product Service we are
going to process that request. We will create a product which has an Id of </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>ABC</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>,
set its price to 5 and very first time we</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>create a
record inside of our Products database. We are going to assign it a version
number and we will start off with the version number of 1.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 98"
src="index_files/image091.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 92</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to produce and emit an event and the event is not going to list not only the Id
and price but also the version as well. The event is going to NATS Streaming
Server,</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 99"
src="index_files/image092.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 93</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>then onto
one of our Cart Services. Inside of our Cart Service we are going to take a
look at this event. We are going to create a record or a cart with an id of </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>ABC</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>, a
price of 5 and because this is the first</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>time we are
creating this record we just say OK let</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s just take a version of 1 and stick
it directly into the database.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 100"
src="index_files/image093.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 94</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>So, we will
put in a price of 5 and then the version of 1.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 101"
src="index_files/image094.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 95</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Now, let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
imagine that we are going to get these two follow up requests in very quick
succession, so the request with the price of 10 then 15.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 102"
src="index_files/image095.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 96</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will
process the request inside of our Product Service. We will go to 10, and
whenever we make an update to our Product, we are going to also increment the
version number. So, any time we make a</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>change to a
product we will always increment the version number. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 103"
src="index_files/image096.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 97</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will do
the same thing with the other request, update the price to 15 and because we
made a change to this record, we will update the version to 3.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 107"
src="index_files/image097.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 98</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Along with
these two requests we just processed we are naturally also going to submit two
separate events. First one has a price of then price of 15.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1182 height=511 id="Picture 106"
src="index_files/image098.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 99</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
imagine what would happen if we process these events in the correct order. We
will process an event with the price of 10 first, and that is the correct order
so Product Service will update the record</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>having Id of
</span><span style='color:black'>'</span><span style='font-size:14.0pt;
line-height:107%'>ABC</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>. The Product Service is going to
look into the database, find a record </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>ABC</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'> and see that it has a version of 1.
It is then going to take a look at the version listed inside that event.
Because</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>we have already
processed version 1 of this record and this incoming record has a version of 2,
we can say there is no missing versions that we are misses out on.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 108"
src="index_files/image099.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 100</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will
process this event, set the price to 10, increment our version to 2 and that is
it.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 109"
src="index_files/image100.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 101</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will then
take care of the other update event. Again, we will take a look at record </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>ABC</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>
and see that we are on version 2. This incoming event describes version 3. We
have not missed any versions.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 110"
src="index_files/image101.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 102</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will
process this thing so we go to price of 15 and a version of 3. This is the ideal
scenario.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 111"
src="index_files/image102.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 103</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
start to process our events out of order. We are going to imagine that we first
process the update to 15, not what we want to do, but it might happen.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We will take
a look at the record of </span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>ABC</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'> and see that it has a version of 1,
but we have a record or an event that describes version 3. That means that we
have missed out on a version 2.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Because we
have a missing version, we would throw some kind of error and say we cannot
process this event right now.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 112"
src="index_files/image103.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 104</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Our listener
would eventually time out on processing this thing. It will timeout because we
will not call act() function (Figure 81) and because we have not acknowledged
this event NATS Streaming Server is</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>going to decide
to reemit it after 5 seconds. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 113"
src="index_files/image104.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 105</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In that 5
second window we are essentially hoping that we are going to see the correct
events start to show up. Product update of version 3 is going to timeout and we
are going to it again in 5 seconds. In</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>the
meantime, we will see that the current events will show up and this one </span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>ABC</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>
has a version of 2. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 114"
src="index_files/image105.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 106</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are
currently in version 1 so we can process this event with incremental version 2,
price of 10. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 115"
src="index_files/image106.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 107</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We
acknowledged that event and after 5 seconds NATS Streaming Server will reissue
the event. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1181 height=511 id="Picture 116"
src="index_files/image107.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 108</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have
processed event version 2, now we are onto version 3, so we can process it
which will change our price to 15, version 3 and we are all done. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>That is how
this version tag is going to make sure that we always process these events in
the correct order.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1025 height=749 id="Picture 118"
src="index_files/image108.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 109</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to look at a little module that we are going to use along with Mongoose to
handle all the versioning stuff for us </span><a
href="https://www.npmjs.com/package/mongoose-update-if-current" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://www.npmjs.com/package/mongoose-update-if-current</span></a></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>If you read
the documentation, you will see this thing can implement optimistic concurrency
control either by using version number or by using a timestamp. We are going to
use a version inside of our app.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1481 height=699 id="Picture 120"
src="index_files/image109.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 110</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>In the code
we have findByEvent function which tries to get a product with some id and the
previous version. If the product is found we acknowledge it otherwise throw an
exception.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=681 height=280 id="Picture 71"
src="index_files/image088.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 111</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Let</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>s
look at the Expiration Service. The service is going to have one single job. It
is going to watch for Product Selected Event coming in. We are going to
definitely implement a listener inside there and then</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>after 15 second
timer publish an event on its own called simple expiration:complete. The goal
of expiration:complete is to tell the Products Service that one of his products
selection has now expired. The</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>sole purpose
of Expiration Service is to have 15-second timer. It is then up to the Product
Service to take a look at the event and decide whether or not it is actually
time to cancel the selection.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=461 height=311 id="Picture 126"
src="index_files/image110.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 112</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Inside of
our Expiration Service we are going to make use of a little library called
Bull.js </span><a href="https://www.npmjs.com/package/bull" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://www.npmjs.com/package/bull</span></a><span
style='font-size:14.0pt;line-height:107%'> This is a JavaScript library that
allows us to essentially setup long live timers.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We are going
to tell us Bull.js to remind us in 15 seconds to do some amount of work. We are
going to pass that command into Bull.js and Bull.js is going to store this little
reminder inside of a Redis</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>instance.
Redis is essentially an in-memory database and it is commonly useful for tasks
exactly like this one. Inside of Redis Bull is going to store a list of jobs;
things that are scheduled to be done at some</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>point in
time. After those 15 seconds Bull.js is going to get a little reminder from
Redis that it needs to so something and Ball in turn is going to tell us that
15 seconds have passed and it is time for us to</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>whatever we
want to do. We are just going to publish events of expitation:complete.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=692 height=211 id="Picture 80"
src="index_files/image111.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 113</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have got
our payment service and our ultimate goal is to reach out to the stripe API and
charge the users credit card for some amount. In order to charge users</span><span
style='color:black'>'</span><span style='font-size:14.0pt;line-height:107%'>
credit card, we are going to install the</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Node.js Stripe
SDK </span><a href="https://www.npmjs.com/package/stripe" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>https://www.npmjs.com/package/stripe</span></a><span
style='font-size:14.0pt;line-height:107%'>. It is an NPM module that has a
little bit of code inside of it to allow us to very easily communicate with the
Stripe API. We are going to call a</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>method
inside there to charge the users</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'> credit card.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>We have to
Stripe Web site </span><a href="http://stripe.com/" target="_blank"><span
style='font-size:14.0pt;line-height:107%'>http://stripe.com</span></a><span
style='font-size:14.0pt;line-height:107%'>, sign up for an account and get an
API key. </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1365 height=603 id="Picture 85"
src="index_files/image112.jpg"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 114</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>You see we
have a Publishable key and Secret Key. Secret key is the one that we want to
make use of inside of our project. It will allow us to reach out to the Strike
API and somehow charge a user</span><span style='color:black'>'</span><span
style='font-size:14.0pt;line-height:107%'>s credit</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>card. Note,
we are on Test mode meaning no money will be charged and you do not even need to
register a credit card.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><img border=0 width=1288 height=757 id="Picture 89"
src="index_files/image113.png"></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>Figure 115</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>For the
testing purposes you can use 4242 4242 4242 4242 Card Information, any valid
three-digit CVC such as 567 and any future date such as 12/34.</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'> </span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:14.0pt;line-height:107%'>&nbsp;</span></p>

</div>

<div>

<hr class=msocomoff align=left size=1 width="33%">

<div>

<div id="_com_1" class=msocomtxt language=JavaScript
onmouseover="msoCommentShow('_anchor_1','_com_1')"
onmouseout="msoCommentHide('_com_1')"><a name="_msocom_1"></a>

<p class=MsoCommentText><span class=MsoCommentReference><span style='font-size:
8.0pt'>&nbsp;<a href="#_msoanchor_1" class=msocomoff>[LTA1]</a></span></span></p>

</div>

</div>

</div>

</body>

</html>
